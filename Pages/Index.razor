@page "/"

<PageTitle>Home</PageTitle>

<h1>Flashcard Library</h1>

<p>Welcome to your personal Flashcard Library. To begin, type the word you are looking for in the search box.</p>

<p>
    <input id="input_Search" type="text" @bind="searchTerm" />
    <button id="btn_Search" @onclick="btn_Search_OnClick">Search</button>
</p>

<p>
    <ul id="ul_flashcards">
        @foreach (var card in flashcards)
        {
            <li>
                <input id="input_Checkbox" type="checkbox" @bind="card.IsDeletedBool" />
                <Multiline Value="@card.DisplayData"/>
            </li>
        }
    </ul>
</p>

<p>
    <button id="btn_Delete" @onclick="btn_Reset_OnClick">Reset</button>
</p>
@code {
    private string searchTerm = string.Empty;
    private List<Flashcard>? _flashcards;
    private List<Flashcard> flashcards
    {
        get
        {
            if (_flashcards != null && _flashcards.Count > 0)
                return _flashcards;
            else
            {
                var context = new FlashcardContext();
                {
                    if (!String.IsNullOrEmpty(searchTerm))
                        return context.Flashcard.Include(flashcard => flashcard.Attachments).Where(x => x.IsDeleted == GlobalVariable.GlobalNoFlag && x.ObjectName.ToLower() == searchTerm.ToLower()).ToList();
                    else
                        return context.Flashcard.Include(flashcard => flashcard.Attachments).Where(x => x.IsDeleted == GlobalVariable.GlobalNoFlag).ToList();
                }
            }
        } 
        set
        {
            _flashcards = value;
        }
    }

    private void btn_Search_OnClick(EventArgs e)
    {
        // call dictionary API to get the JSON result
        Flashcard flashcard = new(searchTerm);
        Flashcard.GetFlashCard(true, flashcard, flashcards);

        flashcards.Add(flashcard);
    }

    private void btn_Reset_OnClick(EventArgs e)
    {
        searchTerm = string.Empty;
        _flashcards?.Clear();
    }

}